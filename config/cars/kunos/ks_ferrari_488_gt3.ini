[LIGHTING]
INTERIOR_FAKE_SHADOW_OPACITY = 0.9
INTERIOR_FAKE_SHADOW_HEIGHT = 0.4
INTERIOR_FAKE_SHADOW_FADE = 0.5
INTERIOR_FAKE_UPPER_SHADOW_HEIGHT = -0.05
INTERIOR_FAKE_UPPER_SHADOW_FADE = 0.1

[SHADOWED_WHEELS]
ANGLE = 7
OPACITY = 0.5

[BRAKEDISC_FX]
AMBIENT_MULT = 2.4

[DEFORMING_HOOD]
NAME = FRONT_HOOD
OFFSET_Y_MIDDLE = 0.04
OFFSET_Y_END = 0.04
OFFSET_Z_END = 0.03
BULGING_EXTRA = 0.05
BULGING_EXPONENT = 2.5
NOISE_Y_AMPLITUDE = 0.4
NOISE_Z_AMPLITUDE = 0.4
NOISE_Y_FREQENCY = 2.0
NOISE_Z_FREQENCY = 3.0
Z_FACTOR = 2.5
Z_BIAS = -0.15

[INCLUDE: common/gt3_exhaust_glow.ini]
ExhaustPoint = 0.35, 0.31, -1.7
ExhaustLightPoint = 0.35, 0.31, -1.9
ExhaustMeshes_MultiMap = material:EXT_Engine_Bottom 

[LIGHT_EXTRA_0_EXHAUST_GLOW, LIGHT_EXTRA_1_EXHAUST_GLOW]
BOUND_TO = GEO_Chassis_SUB5

[INCLUDE: common/gt3_tyres_kunos.ini]

; interior GT3 light
[INCLUDE: common/gt3_lights.ini]
InteriorLightColor = #ff33ff
InteriorLightPos = 0.2, 1.05, 0.4

[EXTRA_FX]
DELAYED_RENDER = 

[INCLUDE: common/materials_carpaint.ini]
CarPaintMaterial = EXT_Carpaint, Ext_carpaint_roof
CarPaintVersionAware = 4
DisableDev = 1

[Material_CarPaint_Solid]
FresnelMax = 1
FresnelC = 0.15

[INCLUDE: common/materials_glass.ini]
ExteriorGlassTintedMaterials = EXT_Glass

;[Material_PhotoelasticGlass]
;Meshes = GEO_Chassis_SUB3
;FilmIOR = 2.5

;[LOCAL_CUBEMAP_...]
;MESHES = GEO_Rollbar, GEO_Int_HR_SUB?        ; list of meshes to change material and add local cubemaps for
;POSITION = 0.2, 0.1, 0.4         ; optional, set position manually (otherwise center of meshes will be used)
;OFFSET = 0.08, 0, 0.13      ; offset for cubemap pivot in meters
;HIGH_RESOLUTION = 0         ; set to 1 in rare cases you would want to use higher resolution
;IS_DYNAMIC = 1              ; set to 1 to enable dynamic update
;DEBUG = 0                   ; set to 1 to enable debug mode to check updating areas
;STATIC_FACES = TOP, BOTTOM, FRONT, LEFT  ; list of faces to stop from being updated dynamically (helps 
;                            ; a lot with performance, so enable debug mode and add as many faces as possible)

[INCLUDE: common/materials_interior.ini]

;[Material_DigitalScreen]
;Materials=INT_Decals_FLAT

[Material_Aluminium_v2]
Materials=INT_Occ_METAL_ALu

[Material_DashboardLeather]
Materials=INT_Occ_Alcantara

[Material_Plastic]
Materials=INT_Decals_Plastic?

[Material_Chrome]
Materials=INT_Decals_Metal_chrome

[Material_Carbon]
Materials=INT_Occ_CARBON_Ferrari, INT_Occ_CARBON_standard

[Material_Metal]
Materials=INT_Decals_Metal_base

; For demonstration purposes let’s replace interior rear view mirror with a mirror with extra features:

; Hide original mirror mesh
[SHADER_REPLACEMENT_...]
MESHES = Extra_Mirror_SUB1
LAYER = 10

; Create a new mirror mesh
[INCLUDE: common/displays.ini]
[DisplayShape]
MeshName = __mirror_display_mesh
ScreenScale = 256
ScreenAspectRatio = 0.5
MatrixType = TN
TreatTextureAsHDR = 1
P1 = -0.033037, 0.853015, 1.069863  ; four corners of new mirror
P2 = -0.109149, 0.844854, 1.013162  ; hold alt and click with objects inspector to get in-car coordinate
P3 = -0.109451, 0.773587, 1.023871  ; pro tip: with 0.1.76, hold Shift to get six digits after the delimiter
P4 = -0.033524, 0.781760, 1.080841

; And create dynamic texture. New mirror is going to have two modes, mirror with overlay and ABS/TC/brake bias control
[SCRIPTABLE_DISPLAY_...]
MESHES = __mirror_display_mesh
RESOLUTION = 512, 512
DISPLAY_POS = 0, 0
DISPLAY_SIZE = 512, 512
SKIP_FRAMES = 0  ; high refresh rate, it’s a mirror in a racing car after all (don’t use it for other displays though)
SCRIPT = '
-- Buttons on display
local displayMesh = display.interactiveMesh{ mesh = "Extra_Mirror_SUB0", resolution = vec2(512, 128) }
local btnModeSwitch = displayMesh.clicked(vec2(200, 7), vec2(45, 26))
local btnMenu = displayMesh.clicked(vec2(254, 7), vec2(45, 26))
local btnMinus = displayMesh.clicked(vec2(308, 7), vec2(45, 26), 0.15)
local btnPlus = displayMesh.clicked(vec2(363, 7), vec2(45, 26), 0.15)
local btnFasterMinus = displayMesh.clicked(vec2(308, 7), vec2(45, 26), 0.05)
local btnFasterPlus = displayMesh.clicked(vec2(363, 7), vec2(45, 26), 0.05)
local btnTurnOff = displayMesh.clicked(vec2(418, 7), vec2(45, 26))

-- Each mode will be drawn by its own function. Here is a function for mirror mode:
local brightnessMult = 1
local selectedOverlay = 1
local updateDelay = 0
local overlayText = ""
function modeMirror(dt)
  -- Eisable real mirror in this mode
  ac.pauseRealMirror(1, false)

  -- Firsly, draw mirror texture across whole thing
  display.mirror{
    pos = vec2(),
    size = vec2(512, 512),
    color = rgb(brightnessMult, brightnessMult, brightnessMult),
    mirrorIndex = 1,           -- for rear mirrors, specifices position of which mirror to use. 0 is for the leftmost
    uvStart = vec2(0.343, 0),  -- these coords are used only if real mirrors are disabled
    uvEnd = vec2(0.658, 1)     -- good thing to switch real mirrors on and off to make sure it all matches
  }

  -- And let’s just put current speed in the top left corner
  if updateDelay <= 0 then
    updateDelay = 0.5
    overlayText = selectedOverlay == 1 and string.format("%.1f km/h", car.speedKmh)
      or selectedOverlay == 2 and string.format("%.1f l", car.fuel)
      or selectedOverlay == 3 and string.format("%.1f C", car.waterTemperature)
  else
    updateDelay = updateDelay - dt
  end
  display.text{
    text = overlayText,
    pos = vec2(40, 408),
    color = rgb(0, 0, 0),
    letter = vec2(24, 64),
    font = "aria",
    width = 432,
    alignment = 1,
    spacing = -6
  }

  if btnPlus() then brightnessMult = math.min(brightnessMult + 0.1, 1.2) end
  if btnMinus() then brightnessMult = math.max(brightnessMult - 0.1, 0) end
  if btnMenu() then 
    selectedOverlay = selectedOverlay + 1
    if selectedOverlay == 4 then
      selectedOverlay = 1
    end
  end
end

-- Second mode for customizing ABS and brake bias
local selectedItem = 1
function modeConfig(dt)
  -- Disable real mirror in this mode
  ac.pauseRealMirror(1, true)

  local colorSelected = rgb(0, 0, 0)
  local colorNotSelected = rgb(1, 1, 1)

  if btnMenu() then
    selectedItem = selectedItem == 1 and 2 or 1
  end

  display.rect{
    pos = vec2(0, 40 + (selectedItem - 1) * 140),
    size = vec2(512, 140),
    color = rgb(0.2, 0.2, 0.2)
  }

  display.text{
    text = car.absMode == 0 and "ABS: disabled" or string.format("ABS: %d/12", car.absMode),
    pos = vec2(40, 70),
    letter = vec2(24, 64),
    color = rgb(1, 1, 1),
    font = "aria",
  }
  display.horizontalBar{ 
    pos = vec2(40, 70+68), 
    size = vec2(432, 8), 
    delta = 6, 
    activeColor = rgb(1, 1, 1), 
    inactiveColor = rgb(0.2, 0, 0), 
    total = 12, 
    active = car.absMode 
  }
  
  local range = car.brakesBiasLimitUp - car.brakesBiasLimitDown
  display.text{
    text = string.format("Brake bias: %.1f%%", car.brakeBias * 100),
    pos = vec2(40, 210),
    letter = vec2(24, 64),
    color = rgb(1, 1, 1),
    font = "aria",
  }
  display.horizontalBar{ 
    pos = vec2(40, 210+68), 
    size = vec2(432, 8), 
    delta = 1, 
    activeColor = rgb(1, 1, 1), 
    inactiveColor = rgb(0.2, 0, 0), 
    total = math.ceil(range / car.brakesBiasStep), 
    active = math.ceil((car.brakeBias - car.brakesBiasLimitDown) / car.brakesBiasStep) 
  }

  if selectedItem == 1 then
    if btnMinus() and car.absMode > 0 then ac.setABS(car.absMode - 1) end  
    if btnPlus() then ac.setABS(car.absMode + 1) end
  else
    if btnFasterMinus() then ac.setBrakeBias(car.brakeBias - car.brakesBiasStep) end  
    if btnFasterPlus() then ac.setBrakeBias(car.brakeBias + car.brakesBiasStep) end
  end
end

-- Storing current mode in variable
local currentMode = modeMirror
local isTurnedOff = false

function update(dt)
  if btnModeSwitch() then
    currentMode = currentMode == modeMirror and modeConfig or modeMirror
    isTurnedOff = false
  end

  if btnTurnOff() then
    isTurnedOff = not isTurnedOff
  end

  if isTurnedOff then
    ac.pauseRealMirror(1, true)
    currentMode = modeMirror
  else
    currentMode(dt)
  end
end'